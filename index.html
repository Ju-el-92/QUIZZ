<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Quizz VTC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Styles CSS */
        body {
            font-family: 'Montserrat', sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
            color: #0C2C1C;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            max-width: 700px;
            width: 100%;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .hidden {
            display: none;
        }

        button {
            background-color: #2A9C64;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 15px;
        }

        button:hover {
            background-color: #228753;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .option {
            display: block;
            width: calc(100% - 24px);
            margin: 12px auto;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            background: #fafafa;
            text-align: left;
            font-size: 1.1em;
            color: #333;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
        }

        .option:hover {
            background-color: #2A9C64;
            border-color: #2A9C64;
            color: white;
            transform: translateY(-2px);
        }

        .option.correct {
            background-color: #2A9C64;
            border-color: #2A9C64;
            color: white;
        }

        .option.incorrect {
            background-color: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }

        .feedback-block {
            margin-top: 25px;
            background: #e8f5e9;
            padding: 15px;
            border-left: 5px solid #2A9C64;
            border-radius: 8px;
            text-align: left;
            font-size: 1em;
            color: #0C2C1C;
        }

        .feedback-block p {
            margin: 0;
            line-height: 1.5;
        }

        .question-block {
            margin-bottom: 30px;
        }

        .question-title {
            font-size: 1.5em;
            color: #2A9C64;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.2em;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
        }

        .result {
            padding: 20px 0;
        }

        .result h2 {
            font-size: 2.5em;
            color: #2A9C64;
            margin-bottom: 20px;
        }

        .score {
            font-size: 2.2em;
            font-weight: bold;
            color: #0C2C1C;
            margin-bottom: 15px;
        }

        .score-message {
            font-size: 1.3em;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .link-block {
            background: #f0f8f0;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d6e9d6;
            margin-bottom: 25px;
        }

        .link-block p {
            margin: 0;
            font-size: 1em;
            color: #333;
        }

        a {
            color: #2A9C64;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        a:hover {
                color: #1a7a4f;
            text-decoration: underline;
        }

        #start-screen {
            padding: 20px 0;
        }
        #start-screen h1 {
            font-size: 2.8em;
            margin-bottom: 20px;
            color: #2A9C64;
        }
        #start-screen p {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #333;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .question-title {
                font-size: 1.3em;
            }
            .question-text {
                font-size: 1em;
            }
            .option {
                padding: 12px;
                font-size: 1em;
            }
            .feedback-block {
                font-size: 0.9em;
            }
            .result h2 {
                font-size: 2em;
            }
            .score {
                font-size: 1.8em;
            }
            .score-message {
                font-size: 1.1em;
            }
            #start-screen h1 {
                font-size: 2.2em;
            }
            #start-screen p {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- The start screen is visible initially -->
        <div id="start-screen">
            <h1>ðŸŽ“ Quizz VTC</h1>
            <p>Ce quizz sâ€™appuie sur les contenus des formations officielles VTC, notamment les modules Â« Relation client et attitudes professionnelles Â» ainsi que Â« RÃ©glementation spÃ©cifique Ã  lâ€™activitÃ© VTC Â».
Il permet une mise Ã  jour rapide et concrÃ¨te des connaissances clÃ©s, utiles pour maintenir une qualitÃ© de service optimale.</p>
            <button id="start-button">DÃ©marrer le Quizz</button>
        </div>

        <!-- This div will be the target for all dynamic content generated by JavaScript -->
        <div id="quiz-container">
            <!-- Quiz content (questions, options, results) will be loaded here by JavaScript -->
        </div>
    </div>

    <script>
        const questions = [
            {
                q: "Quel habitacle les passagers apprÃ©cient-ils le plus ?",
                options: [
                    "Un vÃ©hicule parfaitement propre, sans aucune odeur.",
                    "Une voiture parfumÃ©e avec beaucoup de dÃ©coration.",
                    "Une voiture personnelle avec objets visibles du chauffeur."
                ],
                answer: 0,
                feedback: "Les passagers apprÃ©cient gÃ©nÃ©ralement plus un espace neutre, impeccable et sans odeur marquÃ©e."
            },
            {
                q: "Ã€ quelle frÃ©quence vÃ©rifier la propretÃ© du vÃ©hicule ?",
                options: [
                    "Quotidiennement avant le dÃ©but des courses.",
                    "Seulement quand le client se plaint.",
                    "Une fois par mois."
                ],
                answer: 0,
                feedback: "Une vÃ©rification quotidienne contribue Ã  une bonne premiÃ¨re impression."
            },
            {
                q: "Quelle approche adopter concernant la conversation avec les passagers ?",
                options: [
                    "Parler uniquement si le passager engage la conversation.",
                    "Toujours parler pour Ã©viter le silence.",
                    "Ne jamais parler pendant le trajet."
                ],
                answer: 0,
                feedback: "Beaucoup de passagers prÃ©fÃ¨rent initier eux-mÃªmes lâ€™Ã©change."
            },
            {
                q: "Quel comportement est perÃ§u comme professionnel ?",
                options: [
                    "Maintenir un ton respectueux et calme.",
                    "Donner systÃ©matiquement son avis personnel.",
                    "Imposer une ambiance festive."
                ],
                answer: 0,
                feedback: "Un ton neutre et calme rassure le passager."
            },
            {
                q: "Que faire en cas de retard imprÃ©vu ?",
                options: [
                    "PrÃ©venir immÃ©diatement via l'application ou message.",
                    "Ne rien dire pour ne pas inquiÃ©ter.",
                    "Attendre dâ€™Ãªtre arrivÃ© pour sâ€™excuser."
                ],
                answer: 0,
                feedback: "PrÃ©venir du retard peut renforcer la qualitÃ© perÃ§ue du service."
            },
            {
                q: "Comment rÃ©agir si le passager est en retard ?",
                options: [
                    "Patienter quelques minutes avant dâ€™appeler.",
                    "Klaxonner immÃ©diatement.",
                    "Quitter les lieux aprÃ¨s 1 minute."
                ],
                answer: 0,
                feedback: "La discrÃ©tion et la patience sont valorisÃ©es."
            },
            {
                q: "Quand proposer de lâ€™aide avec les bagages ?",
                options: [
                    "Observer la situation et proposer si besoin.",
                    "Ne jamais proposer son aide.",
                    "Imposer directement son aide sans demander."
                ],
                answer: 0,
                feedback: "Une aide discrÃ¨te et opportune est la mieux perÃ§ue."
            },
            {
                q: "Quelle petite attention est particuliÃ¨rement apprÃ©ciÃ©e ?",
                options: [
                    "Rappeler au passager de vÃ©rifier ses effets personnels.",
                    "Offrir systÃ©matiquement des brochures touristiques.",
                    "Parler politique avec le passager."
                ],
                answer: 0,
                feedback: "Rappeler au passager ses effets personnels montre attention et professionnalisme."
            },
            {
                q: "Quel style de conduite les passagers prÃ©fÃ¨rent-ils ?",
                options: [
                    "Fluide et strictement respectueux du code.",
                    "Rapide pour gagner du temps.",
                    "Dynamique avec dÃ©passements frÃ©quents."
                ],
                answer: 0,
                feedback: "Une conduite fluide et rassurante est prioritaire."
            },
            {
                q: "Quelle est lâ€™attitude recommandÃ©e concernant les appels tÃ©lÃ©phoniques ?",
                options: [
                    "Ã‰viter les appels durant la course.",
                    "TÃ©lÃ©phoner rÃ©guliÃ¨rement pendant la course en utilisant le kit mains-libres.",
                    "Expliquer au passager lâ€™importance de lâ€™appel."
                ],
                answer: 0,
                feedback: "Ne pas passer d'appels contribue Ã  une atmosphÃ¨re calme et professionnelle."
            },
            {
                q: "Quelle gestion de la musique privilÃ©gier ?",
                options: [
                    "Demander au passager sâ€™il souhaite Ã©couter quelque chose.",
                    "Imposer ses propres goÃ»ts musicaux.",
                    "Laisser une musique forte pour dynamiser le trajet."
                ],
                answer: 0,
                feedback: "Une proposition personnalisÃ©e montre votre souci du confort passager."
            },
            {
                q: "Comment gÃ©rer la tempÃ©rature du vÃ©hicule ?",
                options: [
                    "Demander lâ€™avis du passager sur la tempÃ©rature.",
                    "Garder systÃ©matiquement la climatisation forte.",
                    "Ouvrir les fenÃªtres par dÃ©faut."
                ],
                answer: 0,
                feedback: "Un ajustement selon les prÃ©fÃ©rences passager est apprÃ©ciÃ©."
            },
            {
                q: "Quelle tenue vestimentaire privilÃ©gier ?",
                options: [
                    "Une tenue sobre, propre et adaptÃ©e Ã  la saison.",
                    "Une tenue sportive dÃ©contractÃ©e.",
                    "Une tenue Ã©lÃ©gante de soirÃ©e."
                ],
                answer: 0,
                feedback: "Une tenue simple, propre et professionnelle est valorisÃ©e par les passagers."
            },
            {
                q: "Quelle attitude adopter face Ã  un passager mÃ©content ?",
                options: [
                    "Ã‰couter calmement et proposer une solution adaptÃ©e.",
                    "Ignorer complÃ¨tement ses remarques.",
                    "RÃ©pondre agressivement pour montrer son dÃ©saccord."
                ],
                answer: 0,
                feedback: "Une Ã©coute active et la proposition d'une solution calme le passager et amÃ©liore l'expÃ©rience."
            },
            {
                q: "En cas d'objet oubliÃ© par un passager, quelle est la bonne pratique Ã  suivre ?",
                options: [
                    "Contacter immÃ©diatement le passager ou la plateforme concernÃ©e.",
                    "Conserver lâ€™objet sans le signaler.",
                    "Jeter lâ€™objet aprÃ¨s 24 heures."
                ],
                answer: 0,
                feedback: "La rÃ©activitÃ© et l'honnÃªtetÃ© renforcent votre professionnalisme."
            },
            {
                q: "Comment accueillir idÃ©alement un passager Ã  bord ?",
                options: [
                    "Saluer poliment et vÃ©rifier lâ€™identitÃ© du passager.",
                    "Ne rien dire pour Ã©viter tout malentendu.",
                    "Laisser le passager monter sans interaction."
                ],
                answer: 0,
                feedback: "Une salutation polie et une vÃ©rification discrÃ¨te assure un accueil rassurant et professionnel."
            },
            {
                q: "Quelle attitude adopter en cas de dÃ©saccord sur le trajet choisi par le passager ?",
                options: [
                    "Expliquer calmement les alternatives tout en respectant sa dÃ©cision finale.",
                    "Imposer votre itinÃ©raire systÃ©matiquement.",
                    "Refuser le trajet immÃ©diatement."
                ],
                answer: 0,
                feedback: "Une attitude conciliante et informative valorise votre professionnalisme."
            },
            {
                q: "Quelle est la meilleure pratique en cas de demande spÃ©cifique dâ€™un passager (musique, itinÃ©raire prÃ©cis, arrÃªt rapide) ?",
                options: [
                    "Sâ€™adapter Ã  la demande si elle est raisonnable et possible.",
                    "Ignorer les demandes spÃ©cifiques.",
                    "Faire systÃ©matiquement payer plus cher."
                ],
                answer: 0,
                feedback: "La flexibilitÃ© face aux demandes raisonnables amÃ©liore considÃ©rablement l'expÃ©rience client."
            },
            {
                q: "Comment rÃ©agir si un passager utilise un langage ou un comportement inappropriÃ© ?",
                options: [
                    "Garder son calme et rappeler poliment les rÃ¨gles de biensÃ©ance.",
                    "RÃ©pondre agressivement pour montrer son autoritÃ©.",
                    "Ignorer totalement le comportement."
                ],
                answer: 0,
                feedback: "Maintenir son calme tout en rappelant poliment les rÃ¨gles contribue Ã  dÃ©samorcer la situation."
            },
            {
                q: "Quelle rÃ©action adopter en cas dâ€™incident lÃ©ger pendant le trajet (petit accident matÃ©riel sans gravitÃ©) ?",
                options: [
                    "Informer calmement le passager et prendre les dispositions nÃ©cessaires pour assurer sa sÃ©curitÃ©.",
                    "Ignorer lâ€™incident pour Ã©viter dâ€™inquiÃ©ter le passager.",
                    "Exiger que le passager descende immÃ©diatement."
                ],
                answer: 0,
                feedback: "Une gestion calme et sÃ©curisante rassure le passager et confirme votre professionnalisme."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];

        const startScreen = document.getElementById("start-screen");
        const quizContainer = document.getElementById("quiz-container");

        // Fonction utilitaire pour mÃ©langer un tableau (algorithme de Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Ã‰change les Ã©lÃ©ments
            }
            return array;
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            startScreen.classList.add("hidden");
            quizContainer.classList.remove("hidden");
            showQuestion();
        }

        function showQuestion() {
            const current = questions[currentQuestionIndex];

            // PrÃ©pare les options avec leur texte et un indicateur si c'est la bonne rÃ©ponse
            const optionsWithCorrectness = current.options.map((text, i) => ({
                text: text,
                isCorrectOption: (i === current.answer) // Indique si cette option est la bonne rÃ©ponse
            }));

            // MÃ©lange les options
            const shuffledOptions = shuffleArray(optionsWithCorrectness);

            quizContainer.innerHTML = `
                <div class="question-block">
                    <div class="question-title">Question ${currentQuestionIndex + 1}/${questions.length}</div>
                    <div class="question-text">${current.q}</div>
                    ${shuffledOptions.map((opt, i) => `
                        <button class="option" data-is-correct-option="${opt.isCorrectOption}" data-selected-text="${opt.text}">
                            ${opt.text}
                        </button>
                    `).join("")}
                </div>
                <div class="feedback-block hidden" id="current-feedback-block">
                    <p><strong id="feedback-text"></strong></p>
                    <button id="next-question-btn">Suivant</button>
                </div>
            `;

            // Attacher les Ã©couteurs d'Ã©vÃ©nements APRÃˆS que les Ã©lÃ©ments soient crÃ©Ã©s
            const optionsButtons = quizContainer.querySelectorAll(".option");
            optionsButtons.forEach(button => {
                button.addEventListener('click', function() {
                    selectAnswer(this); // Passer le bouton cliquÃ©
                });
            });

            // GÃ©rer le bouton suivant sÃ©parÃ©ment
            document.getElementById("next-question-btn").addEventListener('click', nextQuestion);
        }

        function selectAnswer(clickedButton) {
            const current = questions[currentQuestionIndex];
            const isCorrect = clickedButton.dataset.isCorrectOption === 'true'; // VÃ©rifie la propriÃ©tÃ© mÃ©langÃ©e

            if (isCorrect) score += 3;
            userAnswers.push({
                question: current.q,
                selected: clickedButton.dataset.selectedText, // Texte de l'option cliquÃ©e
                correct: current.options[current.answer], // Texte de la bonne rÃ©ponse originale
                isCorrect: isCorrect,
                feedback: current.feedback
            });

            const optionsButtons = quizContainer.querySelectorAll(".option");
            optionsButtons.forEach(button => {
                // Supprimer tous les Ã©couteurs pour Ã©viter les clics multiples sur les options d'une mÃªme question
                button.removeEventListener('click', arguments.callee); // Retire l'ancien Ã©couteur
                button.style.pointerEvents = 'none'; // DÃ©sactive le bouton visuellement

                if (button.dataset.isCorrectOption === 'true') { // VÃ©rifie si cette option est la bonne
                    button.classList.add("correct");
                } else if (button === clickedButton) { // Si c'est le bouton cliquÃ© et qu'il est faux
                    button.classList.add("incorrect");
                }
            });

            // Afficher le feedback et le bouton "Suivant"
            const feedbackBlock = document.getElementById("current-feedback-block");
            document.getElementById("feedback-text").textContent = `ðŸ’¡ Feedback : ${current.feedback}`;
            feedbackBlock.classList.remove("hidden");
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function getScoreMessage(score) {
            if (score >= 54) return "ðŸ† Excellent ! Vous maÃ®trisez parfaitement les bonnes pratiques VTC.";
            if (score >= 48) return "ðŸ¥‡ TrÃ¨s bien ! Vous avez une bonne comprÃ©hension des standards professionnels.";
            if (score >= 42) return "ðŸ¥ˆ Bien ! Quelques points Ã  revoir pour parfaire votre approche.";
            if (score >= 36) return "ðŸ¥‰ Correct, mais il serait bÃ©nÃ©fique de rÃ©viser certains aspects.";
            return "ðŸ“š Il est recommandÃ© de reprendre la formation pour mieux assimiler les bonnes pratiques.";
        }

        function showResults() {
            const message = getScoreMessage(score);
            quizContainer.innerHTML = `
                <div class="result">
                    <h2>ðŸŽ‰ RÃ©sultats</h2>
                    <p class="score">${score}/60</p>
                    <p class="score-message">${message}</p>
                    <div class="link-block">
                        <p>ðŸ‘‰ Consultez les annales officielles :<br>
                        <a href="https://www.artisanat.fr/nous-connaitre/vous-accompagner/examens-taxi-vtc-vmdtr" target="_blank">
                            AccÃ©der aux annales
                        </a></p>
                    </div>
                    <button id="restart-quiz-btn">Recommencer</button>
                </div>
            `;

            document.getElementById("restart-quiz-btn").addEventListener('click', startQuiz);

            const now = new Date();
            const timestamp = now.toLocaleString('fr-FR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            // PrÃ©paration des donnÃ©es Ã  envoyer Ã  Google Apps Script
            const dataToSend = {
                timestamp: timestamp,
                score: score,
                message: message
            };

            userAnswers.forEach((answer, index) => {
                dataToSend[`Q${index + 1}_Correct`] = answer.isCorrect ? 'True' : 'False';
            });

            // *** C'EST L'URL DE VOTRE APPLICATION GOOGLE APPS SCRIPT ***
            const appsScriptUrl = "https://script.google.com/macros/s/AKfycbwjFZcMo7OYUfFAkyTOGTAogF4-1cNskQ14oRT8F_KLFlv7GAQxm0EQFYShez5PJnzexQ/exec"; 

            fetch(appsScriptUrl, {
                method: "POST",
                headers: {
                    // C'est le changement clÃ© pour le format URL-encoded !
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8', 
                },
                body: new URLSearchParams(dataToSend).toString(), // Convertit l'objet en chaÃ®ne URL-encoded
            })
            .then(response => response.text()) // Lire la rÃ©ponse comme du texte
            .then(text => {
                console.log('RÃ©ponse de Google Apps Script (texte):', text);
                try {
                    const data = JSON.parse(text);
                    if (data.status === "success") {
                        console.log("Les donnÃ©es ont Ã©tÃ© ajoutÃ©es Ã  Google Sheet avec succÃ¨s !");
                    }
                } catch (e) {
                    console.warn('Apps Script n\'a pas retournÃ© du JSON, ou erreur de parsing. Texte:', text, 'Erreur:', e);
                }
            })
            .catch(error => {
                console.error('Erreur lors de l\'envoi des donnÃ©es Ã  Google Sheet:', error);
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            const startButton = document.getElementById("start-button");
            startButton.addEventListener("click", startQuiz);
            quizContainer.classList.add("hidden");
        });
    </script>
</body>
</html>
